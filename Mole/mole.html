<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mole Game</title>

    <style>
        .grid-container {
          display: grid;
          grid-template-columns: auto auto auto;
          background-color: whitesmoke;
        }
        .grid-item {
          background-color: red;
          text-align: center;
        }
    </style>

</head>
<body  onload="canvas.setup()">

    <canvas id="canvasArea1" style="position: absolute; left: 0; top: 0; z-index: 0; width:100%;height:100%"></canvas>
    <canvas id="canvasArea2" style="visibility: hidden; position: absolute; left: 0; top: 0; z-index: 0; width:100%;height:100%"></canvas>
    <p id="score_list">Score: 0</p>
    <div class="grid-container">
        <div class="grid-item" id="00"><img src="Assets/base_image.png" height="250px" width="auto"></div>
        <div class="grid-item" id="01"><img src="Assets/base_image.png" height="250px" width="auto"></div>
        <div class="grid-item" id="02"><img src="Assets/base_image.png" height="250px" width="auto"></div>  
        <div class="grid-item" id="10"><img src="Assets/base_image.png" height="250px" width="auto"></div>
        <div class="grid-item" id="11"><img src="Assets/base_image.png" height="250px" width="auto"></div>
        <div class="grid-item" id="12"><img src="Assets/base_image.png" height="250px" width="auto"></div>  
        <div class="grid-item" id="20"><img src="Assets/base_image.png" height="250px" width="auto"></div>
        <div class="grid-item" id="21"><img src="Assets/base_image.png" height="250px" width="auto"></div>
        <div class="grid-item" id="22"><img src="Assets/base_image.png" height="250px" width="auto"></div>  
    </div>


    <script src="./canvas.js"></script>
    
</body>


<script>

    var previous_mole, current_mole, score, padding_y, padding_x, flag, timeStep, image_height, image_width;
    timeStep = 500;

    function get_page_width(){
        return Math.max(document.documentElement["clientWidth"],document.body["scrollWidth"],document.documentElement["scrollWidth"],document.body["offsetWidth"],document.documentElement["offsetWidth"]);
    }

    function get_page_height(){
        return Math.max(document.documentElement["clientHeight"],document.body["scrollHeight"],document.documentElement["scrollHeight"],document.body["offsetHeight"],document.documentElement["offsetHeight"]);
    }

    function setup(){
        previous_mole = null; // Previous mole position
        current_mole = null; // Current mole position
        
        padding_x = 9; // Leftmost position
        padding_y = 53; // Topmost position
        
        image_height = 250; // Height of image
        image_width = (get_page_width() - 2*padding_x)/3; // Width of image

        score = 0; 
        flag= false; 
        //timeStep = 100;
    }

   
    function check_scored(){
        if(!flag || current_mole == null){
            return false;
        }

        let current_str = current_mole;
        let i = parseInt(current_str[0]);
        let j = parseInt(current_str[1]);

        let left_y = padding_y + i*image_height;
        let right_y = left_y + image_height;

        let top_x = padding_x + j*image_width;
        let bottom_x = top_x + image_width;

        let mouse_x = canvas.mouseDownX;
        let mouse_y = canvas.mouseDownY;

        let x_check = (top_x <= mouse_x) && (mouse_x < bottom_x);
        let y_check = (left_y <= mouse_y) && (mouse_y < right_y);

        return x_check && y_check;
    }

    canvas.keyDownCallback = function(e){
        if(e.keyCode == 65){
            flag = true;
        }
    } 

    function main(){
        canvas.clear();
        if(flag == true){
            let i = Math.floor(Math.random() * 3);
            let j = Math.floor(Math.random() * 3);
            
            if(check_scored() == true){
                score++;
            }

            if(previous_mole != null){
                document.getElementById(previous_mole).style = "background-color: red";
            }

            current_mole = "" + i + j;
            document.getElementById(current_mole).style = "background-color: green" ;
            previous_mole = current_mole;
        }
        document.getElementById("score_list").innerHTML = "Your score is: " + score;
        
    }

    canvas.mainFunction = main;
    canvas.setupFunction = setup;
    canvas.startMain(timeStep);


</script>
</html>